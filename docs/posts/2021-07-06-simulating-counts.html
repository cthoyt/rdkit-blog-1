<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2021-07-06">
<meta name="description" content="An approximation to make working with count vectors more efficient">

<title>RDKit blog - Simulating count fingerprints</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">RDKit blog</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html">
 <span class="menu-text">RDKit experiments, tips, and tutorials</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/rdkit/rdkit"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/rdkit_org"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#bit-vector-similarity-vs-count-based-similarity" id="toc-bit-vector-similarity-vs-count-based-similarity" class="nav-link active" data-scroll-target="#bit-vector-similarity-vs-count-based-similarity">Bit vector similarity vs count-based similarity</a></li>
  <li><a href="#simulating-counts" id="toc-simulating-counts" class="nav-link" data-scroll-target="#simulating-counts">Simulating counts</a></li>
  <li><a href="#results-and-discussion" id="toc-results-and-discussion" class="nav-link" data-scroll-target="#results-and-discussion">Results and discussion</a></li>
  <li><a href="#some-technical-notes" id="toc-some-technical-notes" class="nav-link" data-scroll-target="#some-technical-notes">Some technical notes:</a></li>
  <li><a href="#construct-the-dataset." id="toc-construct-the-dataset." class="nav-link" data-scroll-target="#construct-the-dataset.">Construct the dataset.</a></li>
  <li><a href="#performance-of-similarity-comparisons" id="toc-performance-of-similarity-comparisons" class="nav-link" data-scroll-target="#performance-of-similarity-comparisons">Performance of similarity comparisons</a></li>
  <li><a href="#morgan-2" id="toc-morgan-2" class="nav-link" data-scroll-target="#morgan-2">Morgan 2</a></li>
  <li><a href="#topological-torsions" id="toc-topological-torsions" class="nav-link" data-scroll-target="#topological-torsions">Topological Torsions</a></li>
  <li><a href="#atom-pairs" id="toc-atom-pairs" class="nav-link" data-scroll-target="#atom-pairs">Atom pairs</a></li>
  <li><a href="#rdkit-fingerprint" id="toc-rdkit-fingerprint" class="nav-link" data-scroll-target="#rdkit-fingerprint">RDKit Fingerprint</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Simulating count fingerprints</h1>
  <div class="quarto-categories">
    <div class="quarto-category">fingerprints</div>
    <div class="quarto-category">technical</div>
    <div class="quarto-category">reference</div>
  </div>
  </div>

<div>
  <div class="description">
    An approximation to make working with count vectors more efficient
  </div>
</div>


<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 6, 2021</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<p>Many of the RDKit’s fingerprints are available as either bit vectors or count vectors. Bit vectors track whether or not features appear in a molecule while count vectors track the number of times each feature appears. It seems intuitive that a count vector is a better representation of similarity than bit vectors, but we often use bit vector representations for computational expediency - bit vectors require less memory and are much faster to operate on.</p>
<p>What impact does this using bit vectors have on computed similarity values and the ordering of similarities? This notebook attempts to provide at least a partial answer to that question and also examines a strategy for simulating counts using bit vectors. I look at the following fingerprints: - Morgan 2 - Topological Torsion - Atom Pair - RDKit</p>
<p>And I use two sets of compunds: - Random pairs of compounds taken from <a href="https://greglandrum.github.io/rdkit-blog/fingerprints/similarity/reference/2021/05/18/fingerprint-thresholds1.html">this blog post</a> - Pairs of “related compounds” taken from <a href="https://greglandrum.github.io/rdkit-blog/similarity/reference/2021/05/21/similarity-search-thresholds.html">this blog post</a></p>
<section id="bit-vector-similarity-vs-count-based-similarity" class="level2">
<h2 class="anchored" data-anchor-id="bit-vector-similarity-vs-count-based-similarity">Bit vector similarity vs count-based similarity</h2>
<p>Let’s start with two molecules where this makes a big difference: <img src="../images/blog/simulating-counts1-2.png" class="img-fluid" alt="simulating-counts1-2.png"> The calculated similarity with MFP2 and counts is 0.6 while with bits it’s 0.29. That’s easy to understand since with the bit-based fingerprints the long alkyl chains don’t make the large ontribution to the similarity that they do when using counts.</p>
<p>To demonstrate that this isn’t all about long chains, here’s another pair where there’s a significant difference: <img src="../images/blog/simulating-counts1-3.png" class="img-fluid" alt="simulating-counts1-3.png"> In this case the count-based similarity is 0.59 while with bits it’s 0.35.</p>
<p>Those were a couple of anecdotes, but let’s look at the differences across the entire datasets: <img src="../images/blog/simulating-counts1-4.png" class="img-fluid" alt="simulating-counts1-4.png"> Here I’ve plotted bit-based similarity vs count-based similarity and included statistics on the correlation in the title. The left plot is for the random compound pairs and the right plot is for the related compound pairs. There are significant differences in similarity here, with the bit vector similarities being consistently lower than the count-based equivalent, but it’s worth pointing out that the rankings of the similarities (as measured by the Spearman rank-order correlation values) are reasonably equivalent, particularly for the related compound pairs.</p>
<p>The equivalent plots for the RDKit fingerprint show the same qualitative behavior with the difference that bit vector similarities tend to be <em>higher</em> than count based similarities: <img src="../images/blog/simulating-counts1-5.png" class="img-fluid" alt="simulating-counts1-5.png"></p>
</section>
<section id="simulating-counts" class="level2">
<h2 class="anchored" data-anchor-id="simulating-counts">Simulating counts</h2>
<p>The RDKit has a simple mechanism for simulating counts using bit vectors: set multiple bits for each feature where the number of bits set is determined by the count. The approach uses a fixed number of potential bits which each have a threshold value; if the count for the feature exceeds the threshold value then the corresponding bit is set. Here’s a schematic illustration for count simulation with four bits and the thresholds 1, 2, 4, and 8: <img src="../images/blog/simulating-counts1-6.png" class="img-fluid" alt="simulating-counts1-6.png"> The example shown, with the first two bits set for feature N, is what we’d get if feature N is set either 2 or 3 times in a molecule. Note that we aren’t just using a binary representation of the count itself. In that case a feature which is present one time in the first molecule, representation <code>1000</code>, and two times in the second molecule, representation <code>0100</code>, would contribute zero to the overall similarity. That’s not desirable.</p>
<p>Note that since the count simulation approach uses multiple bits per feature, it decreases the effective length of the fingerprint by a factor equal to the number of bits used. With the default setting of four bits per feature a 2048 bit fingerprint will have the same number of bit collisions as a 512 bit fingerprint without count simulation. This becomes more relevant the more bits a fingerprint tends to set. For example using count simulation to calculate similarity with the RDKit fingerprint, which <a href="https://greglandrum.github.io/rdkit-blog/fingerprints/reference/2021/07/06/number-of-fp-bits-set.html">sets a large number of bits</a>, actually decreases the correlation with the similarity calculated with count vectors (see below for the plot) unless I also increase the overall length of the fingerprint.</p>
</section>
<section id="results-and-discussion" class="level2">
<h2 class="anchored" data-anchor-id="results-and-discussion">Results and discussion</h2>
<p>Here’s a summary of the results for the fingerprints I examine here</p>

<pre><code>&lt;/tr&gt; 
&lt;tr&gt; &lt;th&gt;Fingerprint&lt;/th&gt; &lt;th&gt;Spearman r&lt;/th&gt; &lt;th&gt;MAE&lt;/th&gt; &lt;th&gt;RMSE&lt;/th&gt;
    &lt;th&gt;Spearman r&lt;/th&gt; &lt;th&gt;MAE&lt;/th&gt; &lt;th&gt;RMSE&lt;/th&gt; &lt;th&gt;Note&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt; &lt;td&gt;Morgan 2&lt;/td&gt;
    &lt;td&gt;0.84&lt;/td&gt;&lt;td&gt;0.097&lt;/td&gt;&lt;td&gt;0.10&lt;/td&gt;
    &lt;td&gt;0.90&lt;/td&gt;&lt;td&gt;0.024&lt;/td&gt;&lt;td&gt;0.036&lt;/td&gt;
    &lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt; &lt;td&gt;Topological torsions&lt;/td&gt;
    &lt;td&gt;0.92&lt;/td&gt;&lt;td&gt;0.026&lt;/td&gt;&lt;td&gt;0.051&lt;/td&gt;
    &lt;td&gt;0.98&lt;/td&gt;&lt;td&gt;0.018&lt;/td&gt;&lt;td&gt;0.029&lt;/td&gt;
    &lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt; &lt;td&gt;Topological torsions&lt;/td&gt;
    &lt;td&gt;0.92&lt;/td&gt;&lt;td&gt;0.026&lt;/td&gt;&lt;td&gt;0.051&lt;/td&gt;
    &lt;td&gt;0.99&lt;/td&gt;&lt;td&gt;0.010&lt;/td&gt;&lt;td&gt;0.021&lt;/td&gt;
    &lt;td&gt;8192 bits for count simulation&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt; &lt;td&gt;Atom pairs&lt;/td&gt;
    &lt;td&gt;0.82&lt;/td&gt;&lt;td&gt;0.031&lt;/td&gt;&lt;td&gt;0.049&lt;/td&gt;
    &lt;td&gt;0.90&lt;/td&gt;&lt;td&gt;0.055&lt;/td&gt;&lt;td&gt;0.066&lt;/td&gt;
    &lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt; &lt;td&gt;Atom pairs&lt;/td&gt;
    &lt;td&gt;0.82&lt;/td&gt;&lt;td&gt;0.031&lt;/td&gt;&lt;td&gt;0.049&lt;/td&gt;
    &lt;td&gt;0.96&lt;/td&gt;&lt;td&gt;0.014&lt;/td&gt;&lt;td&gt;0.023&lt;/td&gt;
    &lt;td&gt;8192 bits for count simulation&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt; &lt;td&gt;RDKit&lt;/td&gt;
    &lt;td&gt;0.83&lt;/td&gt;&lt;td&gt;0.079&lt;/td&gt;&lt;td&gt;0.10&lt;/td&gt;
    &lt;td&gt;0.94&lt;/td&gt;&lt;td&gt;0.029&lt;/td&gt;&lt;td&gt;0.045&lt;/td&gt;
    &lt;td&gt;8192 bits for count simulation&lt;/td&gt;
&lt;/tr&gt;</code></pre><table>
<tbody><tr>
<th>
Random pairs
</th>
<th colspan="3" style="text-align:center">
Bits–Count
</th>
<th colspan="3" style="text-align:center">
Count simulation–Count
</th>


</tr></tbody></table>
<pre><code>&lt;/tr&gt; 
&lt;tr&gt; &lt;th&gt;Fingerprint&lt;/th&gt; &lt;th&gt;Spearman r&lt;/th&gt; &lt;th&gt;MAE&lt;/th&gt; &lt;th&gt;RMSE&lt;/th&gt;
    &lt;th&gt;Spearman r&lt;/th&gt; &lt;th&gt;MAE&lt;/th&gt; &lt;th&gt;RMSE&lt;/th&gt; &lt;th&gt;Note&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt; &lt;td&gt;Morgan 2&lt;/td&gt;
    &lt;td&gt;0.94&lt;/td&gt;&lt;td&gt;0.043&lt;/td&gt;&lt;td&gt;0.062&lt;/td&gt;
    &lt;td&gt;0.98&lt;/td&gt;&lt;td&gt;0.019&lt;/td&gt;&lt;td&gt;0.028&lt;/td&gt;
    &lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt; &lt;td&gt;Topological torsions&lt;/td&gt;
    &lt;td&gt;0.90&lt;/td&gt;&lt;td&gt;0.050&lt;/td&gt;&lt;td&gt;0.079&lt;/td&gt;
    &lt;td&gt;0.98&lt;/td&gt;&lt;td&gt;0.021&lt;/td&gt;&lt;td&gt;0.035&lt;/td&gt;
    &lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt; &lt;td&gt;Topological torsions&lt;/td&gt;
    &lt;td&gt;0.90&lt;/td&gt;&lt;td&gt;0.050&lt;/td&gt;&lt;td&gt;0.079&lt;/td&gt;
    &lt;td&gt;0.98&lt;/td&gt;&lt;td&gt;0.018&lt;/td&gt;&lt;td&gt;0.032&lt;/td&gt;
    &lt;td&gt;8192 bits for count simulation&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt; &lt;td&gt;Atom pairs&lt;/td&gt;
    &lt;td&gt;0.91&lt;/td&gt;&lt;td&gt;0.043&lt;/td&gt;&lt;td&gt;0.067&lt;/td&gt;
    &lt;td&gt;0.97&lt;/td&gt;&lt;td&gt;0.052&lt;/td&gt;&lt;td&gt;0.063&lt;/td&gt;
    &lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt; &lt;td&gt;Atom pairs&lt;/td&gt;
    &lt;td&gt;0.91&lt;/td&gt;&lt;td&gt;0.043&lt;/td&gt;&lt;td&gt;0.067&lt;/td&gt;
    &lt;td&gt;0.98&lt;/td&gt;&lt;td&gt;0.020&lt;/td&gt;&lt;td&gt;0.032&lt;/td&gt;
    &lt;td&gt;8192 bits for count simulation&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt; &lt;td&gt;RDKit&lt;/td&gt;
    &lt;td&gt;0.91&lt;/td&gt;&lt;td&gt;0.077&lt;/td&gt;&lt;td&gt;0.11&lt;/td&gt;
    &lt;td&gt;0.98&lt;/td&gt;&lt;td&gt;0.034&lt;/td&gt;&lt;td&gt;0.053&lt;/td&gt;
    &lt;td&gt;8192 bits for count simulation&lt;/td&gt;
&lt;/tr&gt;</code></pre><table>
<tbody><tr>
<th>
Related pairs
</th>
<th colspan="3" style="text-align:center">
Bits–Count
</th>
<th colspan="3" style="text-align:center">
Count simulation–Count
</th>


</tr></tbody></table>
<p>Using the count simulation strategies does improve the match between similarities calculated with bit vectors and those calculated with count vectors. The differences are statistically significant (results not shown here) and large enough to potentially be meaningful. MAE and RMSE values for the various fingerprints typically decrease by at least a factor of two and Spearman rank-order correlation in general increases quite a bit. These conclusions hold for both randomly paired molecules and related pairs with more dramatic differences seen at the lower ends of the similarity scale (the random pairs).</p>
<p>Note that this analysis focuses solely on similarity. The extra information added by doing count simulation will most likely also influence the performance of machine learning models built using these fingerprints. But that’s for a future blog post.</p>
<p>The code to reproduce all of this, along with more plots, is below.</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rdkit <span class="im">import</span> Chem</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rdkit.Chem <span class="im">import</span> rdFingerprintGenerator</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rdkit.Chem <span class="im">import</span> rdMolDescriptors</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rdkit <span class="im">import</span> DataStructs</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rdkit.Chem <span class="im">import</span> Draw</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rdkit.Chem.Draw <span class="im">import</span> IPythonConsole</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rdkit.Chem <span class="im">import</span> rdDepictor</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>rdDepictor.SetPreferCoordGen(<span class="va">True</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> spearmanr</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> median_absolute_error, mean_squared_error</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rdkit</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rdkit.__version__)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>pylab inline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2021.09.1pre
Populating the interactive namespace from numpy and matplotlib</code></pre>
</div>
</div>
</section>
<section id="some-technical-notes" class="level2">
<h2 class="anchored" data-anchor-id="some-technical-notes">Some technical notes:</h2>
<ul>
<li>Note that this notebook uses a couple of features which did not work properly until the v2021.03.4 of the RDKit (which will be released in July).</li>
<li>Count simulation is only generally available when working with the “new” fingerprint generators, so those are used throughout this notebook.</li>
<li>Count simulation is used by default for atom pair and topological torsion fingerprints, both with the “new” fingerprint generators and the older fingerprinting functions.</li>
</ul>
</section>
<section id="construct-the-dataset." class="level2">
<h2 class="anchored" data-anchor-id="construct-the-dataset.">Construct the dataset.</h2>
<p>Start with our standard similarity comparison set:</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> gzip</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> gzip.<span class="bu">open</span>(<span class="st">'../data/chembl21_25K.pairs.txt.gz'</span>,<span class="st">'rt'</span>) <span class="im">as</span> inf:</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    ls <span class="op">=</span> [x.split() <span class="cf">for</span> x <span class="kw">in</span> inf.readlines()]</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>ms <span class="op">=</span> [(Chem.MolFromSmiles(x[<span class="dv">1</span>]),Chem.MolFromSmiles(x[<span class="dv">3</span>])) <span class="cf">for</span> x <span class="kw">in</span> ls]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>That’s weighted towards lower similarity values, get some pairs from the related compounds set:</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> namedtuple</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>MCSRes<span class="op">=</span>namedtuple(<span class="st">'MCSRes'</span>,(<span class="st">'smarts'</span>,<span class="st">'numAtoms'</span>,<span class="st">'numMols'</span>,<span class="st">'avgNumMolAtoms'</span>,<span class="st">'mcsTime'</span>))</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pickle.load(<span class="bu">open</span>(<span class="st">'../data/scaffolds_revisited_again.simplified.pkl'</span>,<span class="st">'rb'</span>))</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>data2 <span class="op">=</span> pickle.load(<span class="bu">open</span>(<span class="st">'../data/scaffolds_expanded.simplified.pkl'</span>,<span class="st">'rb'</span>))</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>data <span class="op">+=</span> data2</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># keep only sets where the MCS was at least 50% of the average number of atoms:</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>keep <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> data <span class="cf">if</span> x[<span class="dv">2</span>].numAtoms<span class="op">&gt;=</span>np.mean(x[<span class="dv">2</span>].avgNumMolAtoms)<span class="op">/</span><span class="dv">2</span>]</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(keep)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>random.seed(<span class="bn">0xf00d</span>)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>related_pairs <span class="op">=</span> []</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co"># keep only molecules matching the MCS:</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i,tpl <span class="kw">in</span> <span class="bu">enumerate</span>(keep):</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    assay,smis,mcs,svg <span class="op">=</span> tpl</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    patt <span class="op">=</span> Chem.MolFromSmarts(mcs.smarts)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    smis <span class="op">=</span> [(x,y) <span class="cf">for</span> x,y <span class="kw">in</span> smis <span class="cf">if</span> Chem.MolFromSmiles(y).HasSubstructMatch(patt)]</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    ssmis <span class="op">=</span> smis[:]</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    random.shuffle(ssmis)</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    related_pairs.extend([(x[<span class="dv">0</span>],x[<span class="dv">1</span>],y[<span class="dv">0</span>],y[<span class="dv">1</span>]) <span class="cf">for</span> x,y <span class="kw">in</span> <span class="bu">zip</span>(smis,ssmis)][:<span class="dv">10</span>])</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'</span><span class="sc">{</span><span class="bu">len</span>(related_pairs)<span class="sc">}</span><span class="ss"> related pairs'</span>)</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>related_ms <span class="op">=</span> [(Chem.MolFromSmiles(x[<span class="dv">1</span>]),Chem.MolFromSmiles(x[<span class="dv">3</span>])) <span class="cf">for</span> x <span class="kw">in</span> related_pairs]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>10470 related pairs</code></pre>
</div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(ms)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>25000</code></pre>
</div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>random.seed(<span class="bn">0xf00d</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>indices <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="bu">len</span>(ms)))</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>random.shuffle(indices)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>random_pairs <span class="op">=</span> [ms[x] <span class="cf">for</span> x <span class="kw">in</span> indices[:<span class="dv">5000</span>]]</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>indices <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="bu">len</span>(related_ms)))</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>random.shuffle(indices)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>related_pairs <span class="op">=</span> [related_ms[x] <span class="cf">for</span> x <span class="kw">in</span> indices[:<span class="dv">5000</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="performance-of-similarity-comparisons" class="level2">
<h2 class="anchored" data-anchor-id="performance-of-similarity-comparisons">Performance of similarity comparisons</h2>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>fpgen <span class="op">=</span> rdFingerprintGenerator.GetMorganGenerator(radius<span class="op">=</span><span class="dv">2</span>,fpSize<span class="op">=</span><span class="dv">2048</span>,countSimulation<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>bv_pairs <span class="op">=</span> [(fpgen.GetFingerprint(x[<span class="dv">0</span>]),fpgen.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> random_pairs]</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>cv_pairs <span class="op">=</span> [(fpgen.GetCountFingerprint(x[<span class="dv">0</span>]),fpgen.GetCountFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> random_pairs]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit _ <span class="op">=</span> [DataStructs.TanimotoSimilarity(x,y) <span class="cf">for</span> x,y <span class="kw">in</span> bv_pairs]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>5.06 ms ± 75 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit _ <span class="op">=</span> [DataStructs.TanimotoSimilarity(x,y) <span class="cf">for</span> x,y <span class="kw">in</span> cv_pairs]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>8.37 ms ± 160 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)</code></pre>
</div>
</div>
<p>Not a huge difference there, but what about a fingerprint which sets a much larger number of bits?</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>fpgen <span class="op">=</span> rdFingerprintGenerator.GetRDKitFPGenerator(fpSize<span class="op">=</span><span class="dv">2048</span>,countSimulation<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>bv_pairs <span class="op">=</span> [(fpgen.GetFingerprint(x[<span class="dv">0</span>]),fpgen.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> random_pairs]</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>cv_pairs <span class="op">=</span> [(fpgen.GetCountFingerprint(x[<span class="dv">0</span>]),fpgen.GetCountFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> random_pairs]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit _ <span class="op">=</span> [DataStructs.TanimotoSimilarity(x,y) <span class="cf">for</span> x,y <span class="kw">in</span> bv_pairs]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>6.22 ms ± 404 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit _ <span class="op">=</span> [DataStructs.TanimotoSimilarity(x,y) <span class="cf">for</span> x,y <span class="kw">in</span> cv_pairs]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>189 ms ± 1.53 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)</code></pre>
</div>
</div>
<p>Here the performance difference is quite noticeable.</p>
</section>
<section id="morgan-2" class="level2">
<h2 class="anchored" data-anchor-id="morgan-2">Morgan 2</h2>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>fpgen1 <span class="op">=</span> rdFingerprintGenerator.GetMorganGenerator(radius<span class="op">=</span><span class="dv">2</span>,fpSize<span class="op">=</span><span class="dv">2048</span>,countSimulation<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>fpsims <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen1.GetFingerprint(x[<span class="dv">0</span>]),fpgen1.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> ms]</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>countsims <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen1.GetCountFingerprint(x[<span class="dv">0</span>]),fpgen1.GetCountFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> ms]</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>related_fpsims <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen1.GetFingerprint(x[<span class="dv">0</span>]),fpgen1.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> related_ms]</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>related_countsims <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen1.GetCountFingerprint(x[<span class="dv">0</span>]),fpgen1.GetCountFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> related_ms]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>fpgen2 <span class="op">=</span> rdFingerprintGenerator.GetMorganGenerator(radius<span class="op">=</span><span class="dv">2</span>,fpSize<span class="op">=</span><span class="dv">2048</span>,countSimulation<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>fpsims_countsim <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen2.GetFingerprint(x[<span class="dv">0</span>]),fpgen2.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> ms]</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>related_fpsims_countsim <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen2.GetFingerprint(x[<span class="dv">0</span>]),fpgen2.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> related_ms]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>delts <span class="op">=</span> <span class="bu">sorted</span>([(countsims[i]<span class="op">-</span>fpsims[i],i) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(fpsims))])</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(delts[:<span class="dv">5</span>])</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(delts[<span class="op">-</span><span class="dv">5</span>:])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[(-0.20329670329670324, 12408), (-0.19358178053830222, 14793), (-0.19191919191919193, 126), (-0.17673378076062635, 1391), (-0.17493796526054584, 13034)]
[(0.31300539083557954, 20013), (0.3151412702245835, 12445), (0.3157622739018088, 13430), (0.3207792207792208, 4381), (0.37206896551724133, 11692)]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>idx <span class="op">=</span> <span class="dv">13430</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Count: </span><span class="sc">{</span>countsims[idx]<span class="sc">:.2f}</span><span class="ss">, Bits: </span><span class="sc">{</span>fpsims[idx]<span class="sc">:.2f}</span><span class="ss">, Simulated counts: </span><span class="sc">{</span>fpsims_countsim[idx]<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>Draw.MolsToGridImage(ms[idx],subImgSize<span class="op">=</span>(<span class="dv">350</span>,<span class="dv">250</span>),molsPerRow<span class="op">=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Count: 0.60, Bits: 0.29, Simulated counts: 0.42</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="15">
<p><img src="2021-07-06-simulating-counts_files/figure-html/cell-16-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>delts <span class="op">=</span> <span class="bu">sorted</span>([(related_countsims[i]<span class="op">-</span>related_fpsims[i],i) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(related_fpsims))])</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(delts[:<span class="dv">5</span>])</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(delts[<span class="op">-</span><span class="dv">5</span>:])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[(-0.26508684133058585, 4359), (-0.24506749740394607, 1322), (-0.2321428571428572, 7602), (-0.21353383458646613, 10080), (-0.20879676440849337, 3804)]
[(0.24318181818181822, 1962), (0.24456938410426782, 1961), (0.24456938410426782, 1969), (0.2455492835432045, 1963), (0.273972602739726, 7774)]</code></pre>
</div>
</div>
<div class="cell" data-scrolled="true" data-execution_count="17">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>idx <span class="op">=</span> <span class="dv">1969</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Count: </span><span class="sc">{</span>related_countsims[idx]<span class="sc">:.2f}</span><span class="ss">, Bits: </span><span class="sc">{</span>related_fpsims[idx]<span class="sc">:.2f}</span><span class="ss">, Simulated counts: </span><span class="sc">{</span>related_fpsims_countsim[idx]<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>Draw.MolsToGridImage(related_ms[idx],subImgSize<span class="op">=</span>(<span class="dv">350</span>,<span class="dv">250</span>),molsPerRow<span class="op">=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Count: 0.59, Bits: 0.35, Simulated counts: 0.52</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="17">
<p><img src="2021-07-06-simulating-counts_files/figure-html/cell-18-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>idx <span class="op">=</span> <span class="dv">4359</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Count: </span><span class="sc">{</span>related_countsims[idx]<span class="sc">:.2f}</span><span class="ss">, Bits: </span><span class="sc">{</span>related_fpsims[idx]<span class="sc">:.2f}</span><span class="ss">, Simulated counts: </span><span class="sc">{</span>related_fpsims_countsim[idx]<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>Draw.MolsToGridImage(related_ms[idx],subImgSize<span class="op">=</span>(<span class="dv">350</span>,<span class="dv">250</span>),molsPerRow<span class="op">=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Count: 0.39, Bits: 0.65, Simulated counts: 0.51</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="18">
<p><img src="2021-07-06-simulating-counts_files/figure-html/cell-19-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>figsize(<span class="dv">18</span>,<span class="dv">9</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>y,x <span class="op">=</span> fpsims,countsims</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'bits'</span>)<span class="op">;</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Random pairs, Morgan2 spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>y,x <span class="op">=</span> related_fpsims,related_countsims</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'bits'</span>)<span class="op">;</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Related pairs, Morgan2 spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2021-07-06-simulating-counts_files/figure-html/cell-20-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>figsize(<span class="dv">18</span>,<span class="dv">9</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>x,y <span class="op">=</span> countsims,fpsims_countsim</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'count simulation'</span>)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)<span class="op">;</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Random pairs, Morgan2 spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>x,y <span class="op">=</span> related_countsims,related_fpsims_countsim</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'count simulation'</span>)</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)<span class="op">;</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Related pairs, Morgan2 spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2021-07-06-simulating-counts_files/figure-html/cell-21-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>fpgen3 <span class="op">=</span> rdFingerprintGenerator.GetMorganGenerator(radius<span class="op">=</span><span class="dv">2</span>,fpSize<span class="op">=</span><span class="dv">8192</span>,countSimulation<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>fpsims_countsim2 <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen3.GetFingerprint(x[<span class="dv">0</span>]),fpgen3.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> ms]</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>related_fpsims_countsim2 <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen3.GetFingerprint(x[<span class="dv">0</span>]),fpgen3.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> related_ms]</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>figsize(<span class="dv">18</span>,<span class="dv">9</span>)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>x,y <span class="op">=</span> countsims,fpsims_countsim2</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'count simulation 8192'</span>)</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)<span class="op">;</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Random pairs, Morgan2 spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>x,y <span class="op">=</span> related_countsims,related_fpsims_countsim2</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'count simulation 8192'</span>)</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)<span class="op">;</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Related pairs, Morgan2 spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2021-07-06-simulating-counts_files/figure-html/cell-22-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="topological-torsions" class="level2">
<h2 class="anchored" data-anchor-id="topological-torsions">Topological Torsions</h2>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>fpgen1 <span class="op">=</span> rdFingerprintGenerator.GetTopologicalTorsionGenerator(fpSize<span class="op">=</span><span class="dv">2048</span>,countSimulation<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>fpsims <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen1.GetFingerprint(x[<span class="dv">0</span>]),fpgen1.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> ms]</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>countsims <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen1.GetCountFingerprint(x[<span class="dv">0</span>]),fpgen1.GetCountFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> ms]</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>related_fpsims <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen1.GetFingerprint(x[<span class="dv">0</span>]),fpgen1.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> related_ms]</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>related_countsims <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen1.GetCountFingerprint(x[<span class="dv">0</span>]),fpgen1.GetCountFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> related_ms]</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>fpgen2 <span class="op">=</span> rdFingerprintGenerator.GetTopologicalTorsionGenerator(fpSize<span class="op">=</span><span class="dv">2048</span>,countSimulation<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>fpsims_countsim <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen2.GetFingerprint(x[<span class="dv">0</span>]),fpgen2.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> ms]</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>related_fpsims_countsim <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen2.GetFingerprint(x[<span class="dv">0</span>]),fpgen2.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> related_ms]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>figsize(<span class="dv">18</span>,<span class="dv">9</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>y,x <span class="op">=</span> fpsims,countsims</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'bits'</span>)<span class="op">;</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Random pairs, TT spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>y,x <span class="op">=</span> related_fpsims,related_countsims</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'bits'</span>)<span class="op">;</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Related pairs, TT spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2021-07-06-simulating-counts_files/figure-html/cell-24-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>figsize(<span class="dv">18</span>,<span class="dv">9</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>x,y <span class="op">=</span> countsims,fpsims_countsim</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'count simulation'</span>)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)<span class="op">;</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Random pairs, TT spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>x,y <span class="op">=</span> related_countsims,related_fpsims_countsim</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'count simulation'</span>)</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)<span class="op">;</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Related pairs, TT spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2021-07-06-simulating-counts_files/figure-html/cell-25-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>fpgen3 <span class="op">=</span> rdFingerprintGenerator.GetTopologicalTorsionGenerator(fpSize<span class="op">=</span><span class="dv">8192</span>,countSimulation<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>fpsims_countsim2 <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen3.GetFingerprint(x[<span class="dv">0</span>]),fpgen3.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> ms]</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>related_fpsims_countsim2 <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen3.GetFingerprint(x[<span class="dv">0</span>]),fpgen3.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> related_ms]</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>figsize(<span class="dv">18</span>,<span class="dv">9</span>)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>x,y <span class="op">=</span> countsims,fpsims_countsim2</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'count simulation 8192'</span>)</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)<span class="op">;</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Random pairs, TT spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>x,y <span class="op">=</span> related_countsims,related_fpsims_countsim2</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'count simulation 8192'</span>)</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)<span class="op">;</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Related pairs, TT spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2021-07-06-simulating-counts_files/figure-html/cell-26-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="atom-pairs" class="level2">
<h2 class="anchored" data-anchor-id="atom-pairs">Atom pairs</h2>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>fpgen1 <span class="op">=</span> rdFingerprintGenerator.GetAtomPairGenerator(fpSize<span class="op">=</span><span class="dv">2048</span>,countSimulation<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>fpsims <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen1.GetFingerprint(x[<span class="dv">0</span>]),fpgen1.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> ms]</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>countsims <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen1.GetCountFingerprint(x[<span class="dv">0</span>]),fpgen1.GetCountFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> ms]</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>related_fpsims <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen1.GetFingerprint(x[<span class="dv">0</span>]),fpgen1.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> related_ms]</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>related_countsims <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen1.GetCountFingerprint(x[<span class="dv">0</span>]),fpgen1.GetCountFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> related_ms]</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>fpgen2 <span class="op">=</span> rdFingerprintGenerator.GetAtomPairGenerator(fpSize<span class="op">=</span><span class="dv">2048</span>,countSimulation<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>fpsims_countsim <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen2.GetFingerprint(x[<span class="dv">0</span>]),fpgen2.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> ms]</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>related_fpsims_countsim <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen2.GetFingerprint(x[<span class="dv">0</span>]),fpgen2.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> related_ms]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>figsize(<span class="dv">18</span>,<span class="dv">9</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>y,x <span class="op">=</span> fpsims,countsims</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'bits'</span>)<span class="op">;</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Random pairs, AP spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>y,x <span class="op">=</span> related_fpsims,related_countsims</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'bits'</span>)<span class="op">;</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Related pairs, AP spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2021-07-06-simulating-counts_files/figure-html/cell-28-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>figsize(<span class="dv">18</span>,<span class="dv">9</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>x,y <span class="op">=</span> countsims,fpsims_countsim</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'count simulation'</span>)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)<span class="op">;</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Random pairs, AP spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>x,y <span class="op">=</span> related_countsims,related_fpsims_countsim</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'count simulation'</span>)</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)<span class="op">;</span></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Related pairs, AP spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2021-07-06-simulating-counts_files/figure-html/cell-29-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>fpgen3 <span class="op">=</span> rdFingerprintGenerator.GetAtomPairGenerator(fpSize<span class="op">=</span><span class="dv">8192</span>,countSimulation<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>fpsims_countsim2 <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen3.GetFingerprint(x[<span class="dv">0</span>]),fpgen3.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> ms]</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>related_fpsims_countsim2 <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen3.GetFingerprint(x[<span class="dv">0</span>]),fpgen3.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> related_ms]</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>figsize(<span class="dv">18</span>,<span class="dv">9</span>)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>x,y <span class="op">=</span> countsims,fpsims_countsim2</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'count simulation 8192'</span>)</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)<span class="op">;</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Random pairs, AP spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>x,y <span class="op">=</span> related_countsims,related_fpsims_countsim2</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'count simulation 8192'</span>)</span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)<span class="op">;</span></span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Related pairs, AP spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2021-07-06-simulating-counts_files/figure-html/cell-30-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="rdkit-fingerprint" class="level2">
<h2 class="anchored" data-anchor-id="rdkit-fingerprint">RDKit Fingerprint</h2>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>fpgen1 <span class="op">=</span> rdFingerprintGenerator.GetRDKitFPGenerator(fpSize<span class="op">=</span><span class="dv">2048</span>,countSimulation<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>fpsims <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen1.GetFingerprint(x[<span class="dv">0</span>]),fpgen1.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> ms]</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>countsims <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen1.GetCountFingerprint(x[<span class="dv">0</span>]),fpgen1.GetCountFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> ms]</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>related_fpsims <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen1.GetFingerprint(x[<span class="dv">0</span>]),fpgen1.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> related_ms]</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>related_countsims <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen1.GetCountFingerprint(x[<span class="dv">0</span>]),fpgen1.GetCountFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> related_ms]</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>fpgen2 <span class="op">=</span> rdFingerprintGenerator.GetRDKitFPGenerator(fpSize<span class="op">=</span><span class="dv">2048</span>,countSimulation<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>fpsims_countsim <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen2.GetFingerprint(x[<span class="dv">0</span>]),fpgen2.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> ms]</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>related_fpsims_countsim <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen2.GetFingerprint(x[<span class="dv">0</span>]),fpgen2.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> related_ms]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>figsize(<span class="dv">18</span>,<span class="dv">9</span>)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>y,x <span class="op">=</span> fpsims,countsims</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'bits'</span>)<span class="op">;</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Random pairs, RDKit spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>y,x <span class="op">=</span> related_fpsims,related_countsims</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)</span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'bits'</span>)<span class="op">;</span></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Related pairs, RDKit spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2021-07-06-simulating-counts_files/figure-html/cell-32-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>figsize(<span class="dv">18</span>,<span class="dv">9</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>x,y <span class="op">=</span> countsims,fpsims_countsim</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'count simulation'</span>)</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)<span class="op">;</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Random pairs, RDKit spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>x,y <span class="op">=</span> related_countsims,related_fpsims_countsim</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'count simulation'</span>)</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)<span class="op">;</span></span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Related pairs, RDKit spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2021-07-06-simulating-counts_files/figure-html/cell-33-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>This is terrible, but I suspect that has to do with the number of bits set by RDKit fingerprints just totally overloading things.</p>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>fpgen3 <span class="op">=</span> rdFingerprintGenerator.GetRDKitFPGenerator(fpSize<span class="op">=</span><span class="dv">8192</span>,countSimulation<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>fpsims_countsim2 <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen3.GetFingerprint(x[<span class="dv">0</span>]),fpgen3.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> ms]</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>related_fpsims_countsim2 <span class="op">=</span> [DataStructs.TanimotoSimilarity(fpgen3.GetFingerprint(x[<span class="dv">0</span>]),fpgen3.GetFingerprint(x[<span class="dv">1</span>])) <span class="cf">for</span> x <span class="kw">in</span> related_ms]</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>figsize(<span class="dv">18</span>,<span class="dv">9</span>)</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>x,y <span class="op">=</span> countsims,fpsims_countsim2</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'count simulation 8192'</span>)</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)<span class="op">;</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Random pairs, RDKit spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>x,y <span class="op">=</span> related_countsims,related_fpsims_countsim2</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>hexbin(x,y,cmap<span class="op">=</span><span class="st">'Blues'</span>,bins<span class="op">=</span><span class="st">'log'</span>)<span class="op">;</span></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>plot((<span class="dv">0</span>,<span class="dv">1</span>),(<span class="dv">0</span>,<span class="dv">1</span>),<span class="st">'k'</span>)<span class="op">;</span></span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'count simulation 8192'</span>)</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'count'</span>)<span class="op">;</span></span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>sr,p <span class="op">=</span> spearmanr(x,y)</span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> median_absolute_error(x,y)</span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> sqrt(mean_squared_error(x,y))</span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>title(<span class="ss">f'Related pairs, RDKit spearman r=</span><span class="sc">{</span>sr<span class="sc">:.3f}</span><span class="ss"> MAE=</span><span class="sc">{</span>mae<span class="sc">:.3f}</span><span class="ss"> RMSE=</span><span class="sc">{</span>rmse<span class="sc">:.3f}</span><span class="ss">'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2021-07-06-simulating-counts_files/figure-html/cell-34-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>That’s way better</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>